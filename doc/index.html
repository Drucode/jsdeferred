<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>JSDeferred</title>

		<style type="text/css">
			body {
				padding: 0 10% 10em;
				margin: 0;
				color: #333;
				line-height: 1.5;
			}

			h2 {
				font-size: 100%;
				margin: 3em 0 1.5em 0;
			}

			pre {
				font-size: 80%;
				background: #efefef;
				border: 1px solid #ddd;
				padding: 0.5em;
				line-height: 1.33;
				overflow: auto;
			}

			var {
				font-style: italic;
				font-weight: bold;
			}

			.body {
				padding: 0 0 0 2em;
			}

			.funname,
			.paren {
				font-weight: bold;
			}

			.args {
				font-weight: normal;
			}

			#footer {
				margin: 2em 0;
				text-align: right;
				font-size: 80%;
			}
		</style>
	</head>
	<body>
		<div id="whole">
			<h1>JSDeferred</h1>

			
			<div class="section" id="0">
				
				
				<h2>Header::</h2>
				
				<div class="body">
				<p>JSDeferred
Copyright (c) 2007 cho45 ( www.lowreal.net )</p>
<p>http://coderepos.org/share/wiki/JSDeferred</p>
<p>Version:: 0.3.0
License:: MIT</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
 </p>
				</di>
			</div>
			
			<div class="section" id="1">
				
				
				<h2>Usage (with jQuery)::</h2>
				
				<div class="body">
				<pre>$.deferred.define();

$.get("/hoge").next(function (data) {
    alert(data);
}).

parallel([$.get("foo.html"), $.get("bar.html")]).next(function (values) {
    log($.map(values, function (v) { return v.length }));
    if (values[1].match(/nextUrl:\s*(\S+)/)) {
        return $.get(RegExp.$1).next(function (d) {
            return d;
        });
    }
}).
next(function (d) {
    log(d.length);
});

 </pre>
				</di>
			</div>
			
			<div class="section" id="Deferred">
				
				
				<h2>
					<span class="funname">
						Deferred
					</span>
					<span class="paren">(</span>
					<span class="args"></span>
					<span class="paren">)</span>
					//=>
					constructor
				</h2>
				
				<div class="body">
				<p><code><a href='#Deferred'>Deferred</a></code> function is constructor of Deferred.</p>
<p>Sample:
</p>
<pre>var d = new Deferred();
// or this is shothand of above.
var d = Deferred();
 </pre>
				</di>
			</div>
			
			<div class="section" id="Deferred.prototype.next">
				
				
				<h2>
					<span class="funname">
						Deferred.prototype.next
					</span>
					<span class="paren">(</span>
					<span class="args">fun</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p>Create new Deferred and sets <var>fun</var> as its callback.
 </p>
				</di>
			</div>
			
			<div class="section" id="Deferred.prototype.error">
				
				
				<h2>
					<span class="funname">
						Deferred.prototype.error
					</span>
					<span class="paren">(</span>
					<span class="args">fun</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p>Create new Deferred and sets <var>fun</var> as its errorback.</p>
<p>If <var>fun</var> not throws error but returns normal value, Deferred treats
the given error is recovery and continue callback chain.
 </p>
				</di>
			</div>
			
			<div class="section" id="Deferred.prototype.call">
				
				
				<h2>
					<span class="funname">
						Deferred.prototype.call
					</span>
					<span class="paren">(</span>
					<span class="args">val</span>
					<span class="paren">)</span>
					//=>
					this
				</h2>
				
				<div class="body">
				<p>Invokes self callback chain.
 </p>
				</di>
			</div>
			
			<div class="section" id="Deferred.prototype.fail">
				
				
				<h2>
					<span class="funname">
						Deferred.prototype.fail
					</span>
					<span class="paren">(</span>
					<span class="args">err</span>
					<span class="paren">)</span>
					//=>
					this
				</h2>
				
				<div class="body">
				<p>Invokes self errorback chain.
 </p>
				</di>
			</div>
			
			<div class="section" id="Deferred.prototype.cancel">
				
				
				<h2>
					<span class="funname">
						Deferred.prototype.cancel
					</span>
					<span class="paren">(</span>
					<span class="args">err</span>
					<span class="paren">)</span>
					//=>
					this
				</h2>
				
				<div class="body">
				<p>Cancels self callback chain.
 </p>
				</di>
			</div>
			
			<div class="section" id="next">
				
				
				<h2>
					<span class="funname">
						next
					</span>
					<span class="paren">(</span>
					<span class="args">fun</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p><code><a href='#next'>next</a></code> is shorthand for creating new deferred which
is called after current queue.
 </p>
				</di>
			</div>
			
			<div class="section" id="chain">
				
				
				<h2>
					<span class="funname">
						chain
					</span>
					<span class="paren">(</span>
					<span class="args">fun...</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p>Construct Deferred chain with array and return its Deferred.
This is shorthand for construct Deferred chains.</p>
<p>Sample:
</p>
<pre>return chain(
    function () {
        return wait(0.5);
    },
    function (w) {
        throw "foo";
    },
    function error (e) {
        alert(e);
    },
    [
        function () {
            return wait(1);
        },
        function () {
            return wait(2);
        }
    ],
    function (result) {
        alert([ result[0], result[1] ]);
    },
    {
        foo: wait(1),
        bar: wait(1)
    },
    function (result) {
        alert([ result.foo, result.bar ]);
    },
    function error (e) {
        alert(e);
    }
);
 </pre>
				</di>
			</div>
			
			<div class="section" id="wait">
				
				
				<h2>
					<span class="funname">
						wait
					</span>
					<span class="paren">(</span>
					<span class="args">sec</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p><code><a href='#wait'>wait</a></code> returns deferred that will be called after <var>sec</var> elapsed
with real elapsed time (msec)</p>
<p>Sample:
</p>
<pre>wait(1).next(function (elapsed) {
    log(elapsed); //=> may be 990-1100
});
 </pre>
				</di>
			</div>
			
			<div class="section" id="call">
				
				
				<h2>
					<span class="funname">
						call
					</span>
					<span class="paren">(</span>
					<span class="args">fun [, args...]</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p><code><a href='#call'>call</a></code> function is for calling function asynchronous.</p>
<p>Sample:
</p>
<pre>// like tail recursion
next(function () {
    function pow (x, n) {
        function _pow (n, r) {
            print([n, r]);
            if (n == 0) return r;
            return call(_pow, n - 1, x * r);
        }
        return call(_pow, n, 1);
    }
    return call(pow, 2, 10);
}).
next(function (r) {
    print([r, "end"]);
});

 </pre>
				</di>
			</div>
			
			<div class="section" id="parallel">
				
				
				<h2>
					<span class="funname">
						parallel
					</span>
					<span class="paren">(</span>
					<span class="args">deferredlist</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p><code><a href='#parallel'>parallel</a></code> wraps up <var>deferredlist</var> to one deferred.
This is useful when some asynchronous resources required.</p>
<p><var>deferredlist</var> can be Array or Object (Hash). If you specify
multiple objects as arguments, then they are wrapped into
an Array.</p>
<p>Sample:
</p>
<pre>parallel([
    $.get("foo.html"),
    $.get("bar.html")
]).next(function (values) {
    values[0] //=> foo.html data
    values[1] //=> bar.html data
});

parallel({
    foo: $.get("foo.html"),
    bar: $.get("bar.html")
}).next(function (values) {
    values.foo //=> foo.html data
    values.bar //=> bar.html data
});
 </pre>
				</di>
			</div>
			
			<div class="section" id="earlier">
				
				
				<h2>
					<span class="funname">
						earlier
					</span>
					<span class="paren">(</span>
					<span class="args">deferredlist</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p>Continue process when one deferred in <var>deferredlist</var> has completed. Others will cancel.
parallel ('and' processing) &lt;=> earlier ('or' processing)
 </p>
				</di>
			</div>
			
			<div class="section" id="loop">
				
				
				<h2>
					<span class="funname">
						loop
					</span>
					<span class="paren">(</span>
					<span class="args">n, fun</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p><code><a href='#loop'>loop</a></code> function provides browser-non-blocking loop.
This loop is slow but not stop browser's appearance.</p>
<p>Sample:
</p>
<pre>//=> loop 1 to 100
loop({begin:1, end:100, step:10}, function (n, o) {
    for (var i = 0; i < o.step; i++) {
        log(n+i);
    }
});

//=> loop 10 times
loop(10, function (n) {
    log(n);
});
 </pre>
				</di>
			</div>
			
			<div class="section" id="repeat">
				
				
				<h2>
					<span class="funname">
						repeat
					</span>
					<span class="paren">(</span>
					<span class="args">n, fun</span>
					<span class="paren">)</span>
					//=>
					Deferred
				</h2>
				
				<div class="body">
				<p>Loop <var>n</var> tiems with <var>fun</var>.
This function automatically return control to browser, if loop time over 20msec.
This is useful for huge loop  not to block browser UI.</p>
<p>Sample::
</p>
<pre>repeat(10, function (i) {
    i //=> 0,1,2,3,4,5,6,7,8,9
});
 </pre>
				</di>
			</div>
			
			<div class="section" id="Deferred.register">
				
				
				<h2>
					<span class="funname">
						Deferred.register
					</span>
					<span class="paren">(</span>
					<span class="args">name, fun</span>
					<span class="paren">)</span>
					//=>
					void 0
				</h2>
				
				<div class="body">
				<p>Register <var>fun</var> to Deferred prototype for method chain.</p>
<p>Sample::
</p>
<pre>// Deferred.register("loop", loop);

// Global Deferred function
loop(10, function (n) {
    print(n);
}).
// Registered Deferred.prototype.loop
loop(10, function (n) {
    print(n);
});
 </pre>
				</di>
			</div>
			
		</div>
	</body>
</html>
